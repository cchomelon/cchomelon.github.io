import{r as d,P as k}from"./katex-BYdhswY7.js";const p=e=>e.replace(/&/gu,"&amp;").replace(/</gu,"&lt;").replace(/>/gu,"&gt;").replace(/"/gu,"&quot;").replace(/'/gu,"&#39;");function m(e){switch(e){case 9:case 32:return!0}return!1}const b=(e,t,o=0)=>{let s=0,r=t-1;for(;r>=o&&e.charCodeAt(r)===92;)s++,r--;return s},C=(e,t,o)=>{const s=e.src.charCodeAt(t-1),r=e.src.charCodeAt(t+1);return{canOpen:o||!m(r),canClose:!(r>=48&&r<=57)&&(o||!m(s))}},_=e=>(t,o)=>{if(t.src[t.pos]!=="$")return!1;let s=C(t,t.pos,e);if(!s.canOpen)return o||(t.pending+="$"),t.pos++,!0;const r=t.pos+1;let a=r,n;const l=t.src.lastIndexOf("$");if(l===-1)return!1;for(;(a=t.src.indexOf("$",a))<=l;){for(n=a-1;t.src.charCodeAt(n)===92;)n--;if((a-n)%2===1)break;a++}if(a===-1)return o||(t.pending+="$"),t.pos=r,!0;if(a-r===0)return o||(t.pending+="$$"),t.pos=r+1,!0;if(s=C(t,a,e),!s.canClose)return o||(t.pending+="$"),t.pos=r,!0;if(!o){const u=t.push("math_inline","math",0);u.markup="$",u.content=t.src.slice(r,a)}return t.pos=a+1,!0},M=()=>(e,t)=>{const o=e.pos;if(e.src.charCodeAt(o)!==92||e.src.charCodeAt(o+1)!==40)return!1;let s=o+2,r=!1;const a=e.src.length;for(;s<a-1;){if(e.src.charCodeAt(s)===92&&e.src.charCodeAt(s+1)===41){if(b(e.src,o)%2===1)return!1;if(b(e.src,s,o+2)%2===0){r=!0;break}}s++}if(!r)return!1;if(!t){const n=e.push("math_inline","math",0);n.markup="\\(",n.content=e.src.slice(o+2,s)}return e.pos=s+2,!0},w=(e,t,o,s)=>{const r=e.bMarks[t]+e.tShift[t];let a=e.eMarks[t];if(r+2>a||e.src.charCodeAt(r)!==36||e.src.charCodeAt(r+1)!==36)return!1;if(s)return!0;let n=e.skipSpacesBack(a,r),l=r+2,u,i=!1;n-l>=2&&e.src.charCodeAt(n-1)===36&&e.src.charCodeAt(n-2)===36?(u=e.src.slice(l,n-2),i=!0):u=e.src.slice(l,a);let c=t,h="";for(;!i&&(c++,!(c>=o||(l=e.bMarks[c]+e.tShift[c],a=e.eMarks[c],l<a&&e.tShift[c]<e.blkIndent)));)n=e.skipSpacesBack(a,l),n-l>=2&&e.src.charCodeAt(n-1)===36&&e.src.charCodeAt(n-2)===36&&(h=e.src.slice(l,n-2),i=!0);e.line=i?c+1:c;const f=e.push("math_block","math",0);return f.block=!0,f.content=(u?`${u}
`:"")+e.getLines(t+1,c,e.tShift[t],!0)+(h?`${h}
`:""),f.map=[t,e.line],f.markup="$$",!0},x=()=>(e,t,o,s)=>{const r=e.bMarks[t]+e.tShift[t];let a=e.eMarks[t];if(r+2>a||e.src.charCodeAt(r)!==92||e.src.charCodeAt(r+1)!==91)return!1;if(s)return!0;let n=e.skipSpacesBack(a,r),l=r+2,u,i=!1;n-l>=2&&e.src.charCodeAt(n-1)===93&&e.src.charCodeAt(n-2)===92?(u=e.src.slice(l,n-2),i=!0):u=e.src.slice(l,a);let c=t,h="";for(;!i&&(c++,!(c>=o||(l=e.bMarks[c]+e.tShift[c],a=e.eMarks[c],l<a&&e.tShift[c]<e.blkIndent)));)n=e.skipSpacesBack(a,l),n-l>=2&&e.src.charCodeAt(n-1)===93&&e.src.charCodeAt(n-2)===92&&(h=e.src.slice(l,n-2).trimEnd(),i=!0);if(!i)return!1;e.line=c+1;const f=e.push("math_block","math",0);return f.block=!0,f.content=(u?`${u}
`:"")+e.getLines(t+1,c,e.tShift[t],!0)+(h?`${h}
`:""),f.map=[t,e.line],f.markup="\\[",!0},g={alt:["paragraph","reference","blockquote","list"]},I=(e,t)=>{if(typeof t?.render!="function")throw new Error('[@mdit/plugin-tex]: "render" option should be a function');const{allowInlineWithSpace:o=!1,mathFence:s=!1,delimiters:r="dollars",render:a}=t;if(s){const n=e.renderer.rules.fence;e.renderer.rules.fence=(...l)=>{const[u,i,,c]=l,{content:h,info:f}=u[i];return f.trim()==="math"?a(h,!0,c):n(...l)}}(r==="dollars"||r==="all")&&(e.inline.ruler.after("escape","math_inline_dollar",_(o)),e.block.ruler.after("blockquote","math_block_dollar",w,g)),(r==="brackets"||r==="all")&&(e.inline.ruler.before("escape","math_inline_bracket",M()),e.block.ruler.after("blockquote","math_block_bracket",x(),g)),e.renderer.rules.math_inline=(n,l,u,i)=>a(n[l].content,!1,i),e.renderer.rules.math_block=(n,l,u,i)=>a(n[l].content,!0,i)},y=(e,t,o)=>{let s;try{s=d(e,{...t,displayMode:!1})}catch(r){/* istanbul ignore else -- @preserve */if(r instanceof k)console.error(r),s=`<span class='katex-error' title='${p(r.toString())}'>${p(e)}</span>`;else throw r}return o?.(s,!1)??s},O=(e,t,o)=>{let s;try{s=`<p class='katex-block'>${d(e,{...t,displayMode:!0})}</p>
`}catch(r){/* istanbul ignore else -- @preserve */if(r instanceof k)console.error(r),s=`<p class='katex-block katex-error' title='${p(r.toString())}'>${p(e)}</p>
`;else throw r}return o?.(s,!0)??s},q=(e,t={})=>{const{allowInlineWithSpace:o=!1,delimiters:s,mathFence:r,logger:a=i=>i==="newLineInDisplayMode"?"ignore":"warn",macros:n={},transformer:l,...u}=t;e.use(I,{allowInlineWithSpace:o,delimiters:s,mathFence:r,render:(i,c,h)=>{const f={strict:(A,$,S)=>a(A,$,S,h)??"ignore",macros:n,throwOnError:!1,...u};return c?O(i,f,l):y(i,f,l)}})};export{q as katex};
//# sourceMappingURL=browser.js.map
